# Unix utils
## Работа с SSH

### Теория
Защищенный сетевой протокол для удалённого управления сервером через интернет поверх TCP (22 порт). В Unix исползьуется встроенный клиент OpenSSH, для Windows обычно используют Putty.  
**Возможности**:
- удаленный запуск программ и выполнения команд на сервере через командную строку;
  - замена telnet;
- передачи данных (почта, видео, изображения и другие файлы) через защищённое соединение;
  - заменить ftp (sftp);
- socks-прокси — обеспечить локальное устройство или целую сеть socks-прокси через удалённую машину;
- алиасы;

**Этапы подключения**:
- Установка TCP соединения
- Открытие защищенного канала: способ шифрования (можно выбрать) и сжатия
- Аутентификация пользователя: при помощи открытого ключа (по-дефолту)

**Способы аутентификации**:
- пароль
- ключи (ssh-keygen)

Типичная комадна: `ssh {user}@{host}`
- host: ip или доменное имя

**Конфиги**:
 - глобальные: `/etc/ssh`
 - пользовательские: `~/.ssh/`
 - содержание:
   - config: файл настройки клиента.
   - authorized_keys: список ключей для доступа к этому пользователю
   - known_hosts: список ключей для хостов, к которым ранее уже было произведено подключение
   - id_*: закрытые ключи доступа для текущего устройства, * - имя алгоритма шифрования
   - id_*.pub: публичные ключи доступа, которые используются для подключения к другим устройствам. * - имя алгоритма шифрования
   - пример:
     - ```
       Host my_server
       Hostname fd12::8
       Port 8022
       IdentityFile ~/.ssh/id_ed25519
       IdentitiesOnly yes
       ```

**Полезные команды**
- scp: копирование файлов на удалённый хост и обратно через SSH
  - пример: `scp my_file user@host:~/`
- `ssh user@host -D 1080`: активировать socks прокси
- `ssh user@host some_command`: выполнение команды

#### Смена порта (сервер)
- `nano /etc/ssh/sshd_config`: отредактировать конфиг
- раскомментировать `#port 22` и поменять на свой
- `/etc/init.d/sshd restart` или `service ssh restart`: перезагрузка сервиса


### Задание
Настрой доступы к своим серверам через ssh keys.

### Установка

#### SSH connection to server
Для соединения по ssh есть bash команда: `ssh`.
- `ssh root@77.37.200.118`
    - root: пользователь
    - 77.37.200.118: ip-адрес назначения
      Если нужно использовать порт отличный от стандартного (TCP: 22), то используется:
    - `ssh root@77.37.200.118 -p 2022`
        - -p 2022: смена порта

#### Troubleshooting
- Warning remote host identification has changed!
    - Почему-то сменилась хеш сумма сервера
    - Удалить ~/.ssh/known_hosts

## Вопросы к ментору
- Например, уволился сотрудник, нужно удалить все его открытые ключи со всех серверов. Как это всë отслеживать и учитывать?

## Полезные ссылки
- [Что такое SSH](https://help.reg.ru/support/hosting/dostupy-i-podklyucheniye-panel-upravleniya-ftp-ssh/chto-takoye-ssh)
- [Как сменить порт доступа к SSH на выделенном сервере](https://help.reg.ru/support/vydelennyye-servery-i-dc/dedicated/rabota-s-dedicated/rabota-s-dedicated-po-ssh#1)
- [Коротко об SSH](https://habr.com/ru/sandbox/166705/)
- [Знакомство с SSH](https://habr.com/ru/articles/802179/)
- [Памятка пользователям ssh](https://habr.com/ru/articles/122445/)
